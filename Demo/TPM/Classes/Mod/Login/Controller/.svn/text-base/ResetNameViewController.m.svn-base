//
//  ResetNameViewController.m
//  STO
//
//  Created by admin on 16/5/12.
//  Copyright © 2016年 JYZD. All rights reserved.
//

#import "ResetNameViewController.h"
#import "EFTextField.h"
#import "SetNickNameEntity.h"


@interface ResetNameViewController ()
@property (weak, nonatomic) IBOutlet EFTextField *textField;
@property (weak, nonatomic) IBOutlet UIButton *confirmBtn;
@property (weak, nonatomic) IBOutlet UIView *dlgView;
@property (weak, nonatomic) IBOutlet UIView *setNicknameView;
@property (weak, nonatomic) IBOutlet UIView *confirmBtnView;
@property (weak, nonatomic) IBOutlet UILabel *topicLabel;
@property (weak, nonatomic) IBOutlet UILabel *noticeLabel;

@end

@implementation ResetNameViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view from its nib.
    
    self.dlgView.layer.cornerRadius = 10;
    self.setNicknameView.layer.cornerRadius = 10;
    self.confirmBtnView.layer.cornerRadius = 10;
    self.confirmBtn.layer.cornerRadius = 2;
    
    //判断用户名字状态(涉及重置昵称or设置昵称)
    UserInfoManager *manager = [UserInfoManager shareUserInfoManager];
    if ([[manager getUserNickNameStatus] isEqualToString:@"2"]) {//审核拒绝
        
        self.topicLabel.text = @"重设昵称";
        self.noticeLabel.text = @"非常抱歉，您设置的昵称经审核含有敏感词，请您重新设置。";
        
    }else{
        
        self.topicLabel.text = @"设置昵称";
        self.noticeLabel.text = @"";
        
    }
    
}

-(void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event
{
    [self.textField resignFirstResponder];
}

- (IBAction)confirmBtnClicked:(id)sender {
    
    [self.textField resignFirstResponder];
    //检查昵称
    NSString *nickname = self.textField.text;
    validateObject *nick = [validateObject object];
    nick.value = nickname;
    ValidateCPBNickName *validNickname = [ValidateCPBNickName validateWithObject:nick];
    if (![validNickname validate]) {
        [WpCommonFunction showNotifyHUDAtViewBottom:self.view withErrorMessage:@"输入的昵称不符合规范，请重新输入"];
        return;
    };
    
    [[UserInfoManager shareUserInfoManager] bindUserWithNickName:nickname Block:^(ReturnValue *val, QUMock *mock, QUEntity *entity) {
       
        if (val.result && [entity isKindOfClass:[SetNickNameEntity class]]) {
            
            SetNickNameEntity *e = (SetNickNameEntity *)entity;
            if ([e.result isEqualToString:@"Y"]) {
                //存入昵称
//                UserInfoManager *manager = [UserInfoManager shareUserInfoManager];
//                manager.myEntity.nick_name = nickname;
                [WpCommonFunction showNotifyHUDAtViewBottom:self.view withErrorMessage:@"昵称重置成功"];
                [self dismissViewControllerAnimated:YES completion:nil];
                
                if ([self.delegate respondsToSelector:@selector(MyViewControllerOnBack)]) {
                    [self.delegate MyViewControllerOnBack];
                }

            }
        }
        
    }];
    
    
}


- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

/*
#pragma mark - Navigation

// In a storyboard-based application, you will often want to do a little preparation before navigation
- (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender {
    // Get the new view controller using [segue destinationViewController].
    // Pass the selected object to the new view controller.
}
*/

@end
