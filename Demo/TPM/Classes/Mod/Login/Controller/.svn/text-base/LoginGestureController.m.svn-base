//
//  LoginGestureController.m
//  QianFangGuJie
//
//  Created by chenyi on 15/5/13.
//  Copyright (c) 2015å¹´ JYZD. All rights reserved.
//

#import <Foundation/Foundation.h>
#import "LoginGestureController.h"
#import "UserInfoEntity.h"
#import "UserInfoMock.h"
#import "noticeMock.h"
#import "noticeEntity.h"

#import "Login3ViewController.h"
#import "LoginViewController.h"
#import "GestureUtil.h"
#import "UserInfoManager.h"

#import "PushManager.h"

@interface LoginGestureController ()<PasswordViewControllerDelegate,QUMockDelegate>





@end

@implementation LoginGestureController
- (void)viewDidLoad {
    [super viewDidLoad];
    self.delegate=self;
}

-(void)viewWillAppear:(BOOL)animated{
    [super viewWillAppear:animated];
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
        NSString* touxiangStr = [[UserInfoManager shareUserInfoManager] getUserLogo];
        NSData* data  = [NSData dataWithContentsOfURL:[NSURL URLWithString:touxiangStr]];
        dispatch_sync(dispatch_get_main_queue(), ^{
            if (data) {
                self.userPhoto.image = [UIImage imageWithData:data];
                    }
        });
    });
    
}


#pragma marks - PasswordViewControllerDelegate

//-(void)pwdViewControllerSwitchAccount:(UIViewController*)vc{
//    [[UserInfoManager shareUserInfoManager] removeUser];
//    [[IndexViewController shareIndexViewController] cleanindex];
////    LoginViewController* controller = [[LoginViewController alloc]initWithNibName:@"LoginViewController" bundle:nil];
////    [self.navigationController pushViewController:controller animated:YES];
//    for (MyViewController* controller in self.navigationController.childViewControllers) {
//        if ([controller isKindOfClass:[LoginViewController class]]) {
//            [self.navigationController popToViewController:controller animated:YES];
//        }
//    }
//}

-(void)pwdViewControllerUnlocked:(UIViewController*)vc{
    DEFINED_WEAK_SELF
    [[ViewControllerManager sharedManager] showWaitView:self.view];
    [[UserInfoManager shareUserInfoManager]LoginSuccessShowWithReturnBlock:^(ReturnValue *val, QUMock *mock, QUEntity *entity) {
        kShareAppDelegate.isFirst = NO;
        [[PushManager sharePushManager] checkDTokenWithUid:[[UserInfoManager shareUserInfoManager] getUserID]];
        [[ViewControllerManager sharedManager] hideWaitView];
        
         if (_self.pwdDelegate && [_self.pwdDelegate respondsToSelector:@selector(pwdViewControllerUnlocked:)]) {
             [_self.pwdDelegate pwdViewControllerUnlocked:_self];
         }
    }];
}

-(void)pwdViewControllerSwitchAnotherWay:(UIViewController*)vc{
//    Login3ViewController* login3controller = [[Login3ViewController alloc]initWithNibName:@"Login3ViewController" bundle:[NSBundle mainBundle]];
//    [self.navigationController pushViewController:login3controller animated:YES];
    [self.pwdDelegate pwdViewControllerSwitchLoginPwd:self];
}

- (IBAction)switchClicked:(id)sender {
    [super switchClicked:sender];
    if (self.pwdDelegate && [self.pwdDelegate respondsToSelector:@selector(pwdViewControllerSwitchAccount:)]) {
        [self.pwdDelegate pwdViewControllerSwitchAccount:self];
    }
}


-(void)closeController{
    
}
@end